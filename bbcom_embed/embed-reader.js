(function(){var s,p;(function(){function a(l){var j=i[l];if(j)return j;if(!g[l])throw new Error("Module "+l+" not found");for(var e=g[l],f=e.deps||(e.length?["require","exports","module"]:[]),k=i[l]={},d=0;d<f.length;d++){var b=f[d];switch(b){case "require":b=function(m){if(m.charAt(0)==="."){for(m=l.substring(0,l.lastIndexOf("/")+1)+m;q!==m;){var q=m;m=m.replace(/\/[^\/]*\/\.\.\//,"/")}m=m.replace(/\/\.\//g,"/")}return a(m)};break;case "exports":b=k;break;case "module":j=b={exports:k};break;default:b=
a(b)}f[d]=b}k=e.apply(this,f);if(j&&j.exports!=i[l])k=j.exports;if(k)return i[l]=k;return i[l]}var g={},i={};s=function(l,j){for(var e=[],f=0;f<l.length;f++)e.push(a(l[f]));j.apply(a,e)};p=s.def=function(l,j,e){if(typeof j=="function")g[l]=j;else(g[l]=e).deps=j}})();p("lingwo_dictionary/util/extendPrototype",[],function(){return function(a,g){for(var i in g)a.prototype[i]=g[i]}});p("lingwo_dictionary/util/declare",["lingwo_dictionary/util/extendPrototype"],function(a){return function(g){var i=g._constructor;
delete g._constructor;a(i,g);return i}});p("lingwo_dictionary/layout/Popup",["jquery","lingwo_dictionary/util/declare"],function(a,g){return g({_constructor:function(i){this.popup=i.node},shutdown:function(){},layout:function(i){i=a(i);var l=a(this.popup),j=l.width(),e=i.offset(),f=e.left+i.width()/2-j/2;i=e.top+i.height()+40;e=a(document).width();if(f+j>e)f=e-j;if(f<0)f=0;l.show().css({left:f,top:i})}})});p("lingwo_dictionary/util/clobber",[],function(){return function(a,g,i){old_fn=a[g];a[g]=function(){old_fn.apply(this,
arguments);i()}}});p("lingwo_dictionary/util/clone",[],function(){return function(a){var g={},i;for(i in a)g[i]=a[i];return g}});p("lingwo_dictionary/util/proxy",[],function(){return function(a,g){return function(){return a.apply(g,arguments)}}});s.def("lingwo_dictionary/annotation/Reader2",["jquery","lingwo_dictionary/layout/Popup","lingwo_dictionary/util/clobber","lingwo_dictionary/util/clone","lingwo_dictionary/util/proxy"],function(a,g,i,l,j){var e,f,k=/MSIE 6/i.test(navigator.userAgent),d={layout:"docked"};
f={popup:{setup:function(){e.bubbleNode.addClass("popup");this._layout=new g({node:e.bubbleNode})},shutdown:function(){e.bubbleNode.removeClass("popup");this._layout.shutdown()},show:function(){var b=e.bubbleNode;this._layout.layout(e.selectedNode);b.css("height","");if(k||b.height()>200)b.css({height:200})},hide:function(){e.bubbleNode.hide()}},docked:{_dock:null,_footer:null,_footerId:null,_footerMargin:null,_positionBubble:function(){e.bubbleNode.show();var b=e.bubbleNode,m=this._dock.offset(),
q=this._footer.offset().top;b.outerWidth();b.innerWidth();var u=b.outerHeight()-b.innerHeight(),c=Math.max(m.top-a(window).scrollTop()+1,0);q=Math.min(q-a(window).scrollTop()-c-this._footerMargin+1,a(window).height()-c)-u;b.css({left:m.left-a(window).scrollLeft(),top:c,height:q})},_drupalHack:false,setup:function(){e.bubbleNode.addClass("docked");this._dock=a("#lingwo-korpus-dock");this._footerId=this._dock.attr("data-footer-id");this._footerMargin=this._dock.attr("data-footer-margin");this._footer=
a("#"+this._footerId);var b=j(this._positionBubble,this);a(window).bind("scroll.lingwoReaderDocked",b);a(window).bind("resize.lingwoReaderDocked",b);if(!this._drupalHack){typeof window.Drupal!="undefined"&&Drupal.adminToolbar&&i(Drupal.adminToolbar,"setState",function(){if(e.layout===f.docked){e.bubbleNode.hide();setTimeout(b,500)}});this._drupalHack=true}e.setBubbleContent("<em>Click a work in the text to look it up in the dictionary.</em>");setTimeout(b,0)},shutdown:function(){e.bubbleNode.removeClass("docked");
this._dock=this._footerId=this._footerMargin=this._footer=null;a(window).unbind(".lingwoReaderDocked")},show:function(){},hide:function(){}}};return e={defaultLayouts:f,onLoad:function(){},config:null,bubbleNode:null,contentNode:null,selectedNode:null,shown:false,isSetup:false,layout:null,setup:function(b){if(typeof b=="undefined")b=l(d);this.config=b;if(this.config.layout=="docked"&&k)this.config.layout="popup";if(this.isSetup){this.layout.shutdown();this.layout=null;this.isSetup=false}if(!this.bubbleNode)this.bubbleNode=
a("<div></div>").attr("id","lingwo-korpus-entry-view-wrapper").appendTo(a("body")).hide();if(!this.contentNode)this.contentNode=a("<div></div>").attr("id","lingwo-korpus-entry-view").appendTo(this.bubbleNode);b=typeof this.config.layout=="string"?f[this.config.layout]:this.config.layout;b.setup();this.config.skipHoverEvents||this.setupHoverEvents();this.layout=b;this.isSetup=false},setupHoverEvents:function(){a(".anno, .anno-anchor").unbind("mouseenter mouseleave").bind("mouseenter",function(b){b=
a(b.target);b.addClass("hover");if(b=e._getAnnoText(b))b.addClass("hover")}).bind("mouseleave",function(b){b=a(b.target);b.removeClass("hover");if(b=e._getAnnoText(b))b.removeClass("hover")})},_getAnnoText:function(b){if(b.hasClass("anno-anchor"))if(b=b.attr("data-anno"))return a("#"+b);return null},setSelection:function(b){var m;if(this.selectedNode){this.selectedNode.removeClass("selected");if(m=this._getAnnoText(this.selectedNode))m.removeClass("selected");this.selectedNode=null}if(b){b=a(b);b.addClass("selected");
this.selectedNode=b;if(m=this._getAnnoText(this.selectedNode))m.addClass("selected")}},clearSelection:function(){this.setSelection(null)},isInsideBubble:function(b){for(;b=b.parentNode;)if(b.id=="lingwo-korpus-entry-view")return true;return false},showBubble:function(){this.layout.show();this.shown=true},hideBubble:function(){this.layout.hide();this.shown=false},setBubbleContent:function(b){this.contentNode.html(b)},setBubbleLoading:function(){this.setBubbleContent("Loading...")},isWordNode:function(b){return a(b).hasClass("anno")||
a(b).hasClass("anno-anchor")},handleClick:function(b){if(this.isWordNode(b)){if(this.isInsideBubble(b))this.onLoad(a(b));else{this.setSelection(b);this.onLoad(this.selectedNode);this.showBubble()}return false}this.clearSelection();this.hideBubble()}}});p("lingwo_dictionary/layout/BottomDock",["jquery","lingwo_dictionary/util/declare","lingwo_dictionary/util/proxy"],function(a,g,i){function l(){var f=null;if(document.createElement){var k=document.createElement("div");if(k&&k.style){k.style.position=
"fixed";k.style.top="10px";var d=document.body;if(d&&d.appendChild&&d.removeChild){d.appendChild(k);f=k.offsetTop===10;d.removeChild(k)}}}return f}var j=navigator.userAgent.toLowerCase(),e=l()&&!/iphone|ipod|android/.exec(j);return g({_constructor:function(f){this.node=f.node;this.size=f.size;this.spacerNode=a("<div></div>").appendTo(a("body")).css("height",this.size).get(0);a(this.node).css({position:e?"fixed":"absolute",overflow:"hidden"}).appendTo(a("body"));this._layoutProxy=i(this.layout,this);
a(window).bind("resize",this._layoutProxy);e||a(window).bind("scroll",this._layoutProxy)},shutdown:function(){a(window).unbind("resize",this._layoutProxy);e||a(window).unbind("scroll",this._layoutProxy);a(this.node).remove();a(this.spacer).remove()},onlayout:function(){},layout:function(){var f=Math.min(a(window).width(),a(document).width()),k=a(window).height(),d=a(document).height();k=k-this.size;var b=0;if(!e){k+=a(window).scrollTop();b+=a(window).scrollLeft()}if(k+this.size>d)k=d-this.size;a(this.spacerNode).css("height",
this.size);a(this.node).css({top:k,left:b,width:f,height:this.size});this.onlayout(k,b,f,this.size)}})});p("bibliobird/Embed",["jquery","lingwo_dictionary/annotation/Reader2","lingwo_dictionary/layout/BottomDock","lingwo_dictionary/util/declare"],function(a,g,i,l){function j(c){var h=q[d.lang][c];return h?h:c}function e(c,h,o){var n;for(n in h)if(!o||typeof c[n]=="undefined")c[n]=h[n]}function f(c){var h=d.url.replace("<lang>",d.lang);if(c)return h+"/"+c;return h}function k(c){this.node=c;this.url=
a(c).attr("data-url")||d.getPageUrl();this.teaser=a(c).attr("data-teaser")=="true";this.links=a('<div class="bibliobird-links"></div>').insertBefore(c);this.data={};this.lookupContent()}var d={},b={url:"http://<lang>.bibliobird.com",lang:"en",showLinks:true,ga:true,pageUrlRemove:"#",getPageUrl:function(){var c=""+window.self.location.href;switch(d.pageUrlRemove){case "?":c=c.split("?")[0];case "#":c=c.split("#")[0]}return c}},m={en:"English",pl:"Polski"},q={en:{}},u;q.pl={"Translate to":"T\u0142umacz na",
"Words I Am Learning":"M\u00f3j osobisty s\u0142owniczek",Hello:"Cze\u015b\u0107",Login:"Zaloguj si\u0119",or:"lub",register:"utw\u00f3rz konto","on BiblioBird":"w systemie BiblioBird","not me!":"to nie ja!"};u=l({_constructor:function(){this.innerNode=a('<div id="bibliobird-dock" class="clear-block"></div>').get(0);this.node=a("<div></div>").css("zIndex","101").append(this.innerNode).get(0);this.userNode=a("<div></div>").css({"float":"left","padding-left":10}).get(0);this._rebuild();this._layout=
new i({node:this.node,size:35});this._layout.layout()},_rebuild:function(){var c,h,o,n=this;this.innerNode.innerHTML="";h=a('<select id="bibliobird-language-switcher"></select>').get(0);for(c in m){o=a("<option>"+m[c]+"</option>");o.attr("value",c);c==d.lang&&o.attr("selected","selected");a(h).append(o)}a(h).bind("change",function(){d.lang=a("option:selected",h).val();n._rebuild()});c=a('<a id="bibliobird-wial-button"></a>').css({display:"block","float":"right",background:"transparent url('http://en.bibliobird.com/sites/all/themes/lingwoorg_theme/images/join-btn-left.png') left no-repeat",
"padding-left":11,height:27,"margin-left":10,"margin-top":2,color:"white","font-size":"12px","font-weight":"bold","text-decoration":"none",cursor:"pointer"}).attr({href:f("wial"),target:"_blank"}).append(a("<span></span>").css({display:"block","float":"left",background:"transparent url('http://en.bibliobird.com/sites/all/themes/lingwoorg_theme/images/join-btn-right.png') right no-repeat","padding-right":14,height:27,cursor:"pointer"}).append(a("<span></span>").css({display:"block","float":"left",
background:"transparent url('http://en.bibliobird.com/sites/all/themes/lingwoorg_theme/images/join-btn-middle.png') center repeat-x","padding-top":4,height:23,cursor:"pointer"}).text(j("Words I Am Learning"))));a(this.innerNode).css({height:"100%",background:"#e5e5f9","border-top":"1px solid black","font-size":"14pt"}).append(a("<div>BiblioBird</div>").css({"float":"left",background:"#07104C","font-weight":"bold",height:"100%",color:"white","font-size":"16pt",padding:"0 10px","border-right":"1px solid white"})).append(this.userNode).append(a("<div></div>").css({"float":"right",
"padding-right":"10px"}).append('<label for="bibliobird-language-switcher">'+j("Translate to")+": </label>").append(h).append(c));this.rebuildLinks()},rebuildLinks:function(){var c=a(this.userNode);a("#bibliobird-wial-button",this.node)[d.username?"show":"hide"]();c.html("");if(d.username){c.append(j("Hello")+", "+d.username+"!  (");c.append(a("<a></a>").html(j("not me!")).attr("href",f("logout")).click(function(){d.logout();return false}));c.append(")")}else{c.append(j("Hello")+"!  ");c.append(a("<a></a>").html(j("Login")).attr("href",
f("remote/login")+(d.localRelayUrl?"?relay="+d.localRelayUrl:"")).click(function(h){d.openEmbedWindow(h.target.href);return false}));c.append(" "+j("or")+" ");c.append(a("<a></a>").html(j("register")).attr({href:f("user/register"),target:"_blank"}));c.append(" "+j("on BiblioBird")+".")}}});if(typeof window.BiblioBird!="undefined")d=window.BiblioBird;e(d,b,true);e(d,{initialized:false,contentAreas:[],embedWindow:null,embedIframe:null,embedWindowShown:false,username:null,isRemoteIframe:false,bottomDock:null,
hasContent:false,start:function(){window.self!==window.top&&window.self.location.hash&&this._readHashOptions();a(".bibliobird-content").each(function(){d.contentAreas.push(new k(this))})},_readHashOptions:function(){var c=(""+window.self.location.hash).split("&"),h={},o,n;for(o=0;o<c.length;o++){n=c[o].split("=");h[n[0]]=n[1]}if(h["#iam"]=="bibliobird")this.isRemoteIframe=true},initialize:function(c,h){function o(){var r=(a(window).width()-400)/2,t=(a(window).height()-200)/2;n.css({top:t,left:r})}
if(!this.hasContent&&h){if(!this.isRemoteIframe)this.bottomDock=new u;this.hasContent=h}if(!this.initialized){var n=a('<div class="clear-block"><div class="bibliobird-embed-titlebar"><span class="bibliobird-embed-title">BiblioBird</span> <a href="#" class="bibliobird-embed-close">close</a></div></div>');h=a('<iframe height="100%" width="100%" border="0" id="bibliobirdEmbedIframe" name="bibliobirdEmbedIframe"></iframe>').appendTo(n);n.css({width:400,height:200,position:"fixed",border:"1px solid black",
background:"white",display:"none"}).appendTo(a("body"));a(".bibliobird-embed-close",n).click(function(){d.hideEmbedWindow();return false});a(window).resize(o);setTimeout(o,0);g.setup({layout:"popup",skipHoverEvents:true});a("body").click(function(r){d.hideEmbedWindow();return g.handleClick(r.target)});e(this,{embedWindow:n,embedIframe:h,username:c,initialized:true})}},receiveMessage:function(c){if(c.indexOf("#login-successful")==0){c=c.split(":");if(c[1])this.username=c[1];this.hideEmbedWindow()}},
openEmbedWindow:function(c){if(this.embedWindow!==null&&!this.embedWindowShown){this.embedIframe.attr("src",c);this.embedWindow.show();this.embedWindowShown=true}},hideEmbedWindow:function(){if(this.embedWindow!==null&&this.embedWindowShown){this.embedWindow.hide();this.embedWindowShown=false;this.refreshAll()}},logout:function(){var c=this;a.ajax({url:f("remote/logout"),dataType:"jsonp",success:function(){c.username=null;c.refreshAll()}})},refreshAll:function(){a.each(this.contentAreas,function(){this.refresh()});
this.bottomDock&&this.bottomDock.rebuildLinks()}});g.onLoad=function(c){c=(c.attr("data-entry")||"").split("#");var h=c[0],o=c[1];g.setBubbleLoading();a.ajax({url:f("embed-reader/lookup_entry"),dataType:"jsonp",data:{hash:h,lang:d.lang},success:function(n){g.setBubbleContent(n.content);d.ga&&typeof window._gaq!="undefined"&&_gaq.push(["_trackEvent","BiblioBird","Anonymous Lookup",d.lang]);a(".node",g.contentNode).removeClass("clear-block").removeAttr("id");a("ul.links.inline",g.contentNode).remove();
o&&a(".lingwo-sense-id-"+o,g.contentNode).addClass("selected");a("a",g.contentNode).each(function(r,t){r=t.href;var v;if(r){v=window.self.location.protocol+"//"+window.self.location.host;t.href=r.replace(v,f());t.target="_blank"}})}})};e(k.prototype,{lookupContent:function(){var c=this;a.ajax({url:f("embed-reader/lookup_content"),dataType:"jsonp",data:{url:this.url},success:function(h){d.initialize(h.username,!!h.content);c.data=h;c.rebuildLinks();if(h.content){c.node.innerHTML=h.content;g.setupHoverEvents()}}})},
rebuildLinks:function(){if(d.showLinks){var c=this.links,h=this.data;c.html("");h.not_found&&c.append(a("<a></a>").html("Add to Bibliobird").attr({href:f("node/add/content?remote_url="+escape(this.url)),target:"_blank"}))}},refresh:function(){this.rebuildLinks()}});return window.BiblioBird=d});s.def("jquery",[],function(){return window.jQuery});s.def("jQuery",[],function(){return window.jQuery});s(["bibliobird/Embed"],function(a){a.start()})})();
