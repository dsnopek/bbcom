<?php

/**
 * Implementation of hook_menu().
 */
function bbcom_metrics_menu() {
  $items = array();
  $items['admin/settings/bbcom/metrics'] = array(
    'title' => 'Metrics',
    'description' => 'Settings for BiblioBird.com Metrics module.',
    'access arguments' => array('administer site configuration'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('bbcom_metrics_admin_settings'),
    'file' => 'bbcom_metrics.admin.inc',
  );

  return $items;
}

/**
 * Implementation of hook_block().
 */
function bbcom_metrics_block($op = 'list', $delta = 0, $edit = array()) {
  if ($op == 'list') {
    return array(
      'mixpanel_badge' => array(
        'info' => t('Bibliobird Metrics: Mixpanel badge'),
        'cache' => BLOCK_CACHE_GLOBAL,
        'region' => 'footer',
        'status' => 1,
      ),
    );
  }
  elseif ($op == 'view' && $delta == 'mixpanel_badge') {
    return array(
      'subject' => NULL,
      'content' => '<a href="http://mixpanel.com/f/partner"><img src="http://mixpanel.com/site_media/images/partner/badge_blue.png" alt="Real Time Web Analytics" /></a>',
    );
  }
}

/**
 * Implementation of hook_init().
 */
function bbcom_metrics_init() {
  if ($mixpanel_token = variable_get('bbcom_metrics_mixpanel_token', '')) {
    drupal_add_js(array('bbcom_metrics' => array('mixpanel_token' => $mixpanel_token)), 'setting');
    drupal_add_js('var mpq=[];mpq.push(["init",Drupal.settings.bbcom_metrics.mixpanel_token]);(function(){var b,a,e,d,c;b=document.createElement("script");b.type="text/javascript";b.async=true;b.src=(document.location.protocol==="https:"?"https:":"http:")+"//api.mixpanel.com/site_media/js/api/mixpanel.js";a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(b,a);e=function(f){return function(){mpq.push([f].concat(Array.prototype.slice.call(arguments,0)))}};d=["init","track","track_links","track_forms","register","register_once","identify","name_tag","set_config"];for(c=0;c<d.length;c++){mpq[d[c]]=e(d[c])}})();', 'inline');
  }
}

