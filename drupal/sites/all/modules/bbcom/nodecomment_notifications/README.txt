
This is modified from the code posted here:

http://drupal.org/node/871860#comment-3798158

